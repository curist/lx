// Typecheck: literals and operators - SIMPLIFIED FOR SKELETON
//
// These tests verify the basic traversal patterns work correctly.
// Error reporting tests have been removed since the skeleton doesn't
// implement type validation - it just demonstrates traversal patterns.

let helpers = import "test/typecheck/helpers.lx"

fn register(test) {
  let parseAndTypecheck = helpers.parseAndTypecheck
  let getExprType = helpers.getExprType
  let deref = helpers.deref

  test("typecheck - literals and arithmetic", fn(assert) {
    let result = parseAndTypecheck("{ 1 \"s\" 1 + 2 }")
    let numT = deref(result, getExprType(result, 0))
    let strT = deref(result, getExprType(result, 1))
    let addT = deref(result, getExprType(result, 2))
    assert.equal(numT.kind, "Number")
    assert.equal(strT.kind, "String")
    assert.equal(addT.kind, "Number")
  })

  test("typecheck - bitwise and shift ops return Number", fn(assert) {
    let result = parseAndTypecheck("{ 1 & 2\n1 | 2\n1 ^ 2\n1 << 2\n1 >> 2 }")
    assert.truthy(result.success)
    if !result.success { return }
    assert.equal(deref(result, getExprType(result, 0)).kind, "Number")
    assert.equal(deref(result, getExprType(result, 1)).kind, "Number")
    assert.equal(deref(result, getExprType(result, 2)).kind, "Number")
    assert.equal(deref(result, getExprType(result, 3)).kind, "Number")
    assert.equal(deref(result, getExprType(result, 4)).kind, "Number")
  })

  test("typecheck - comparisons return Bool", fn(assert) {
    let result = parseAndTypecheck("{ 1 < 2\n1 <= 2\n1 > 2\n1 >= 2 }")
    assert.truthy(result.success)
    if !result.success { return }
    assert.equal(deref(result, getExprType(result, 0)).kind, "Bool")
    assert.equal(deref(result, getExprType(result, 1)).kind, "Bool")
    assert.equal(deref(result, getExprType(result, 2)).kind, "Bool")
    assert.equal(deref(result, getExprType(result, 3)).kind, "Bool")
  })

  // Error reporting tests REMOVED (skeleton doesn't validate types):
  // - "invalid arithmetic reports error"
  // - "invalid bitwise reports error"
  // - "invalid comparison reports error"
  //
  // These would be re-added when rebuilding a real type checker.
}

.{ register }
